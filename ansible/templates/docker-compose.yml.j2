services:
  cloudflared:
    image: cloudflare/cloudflared:latest
    container_name: cloudflared
    restart: always
    user: "{{ apps_uid }}:{{ apps_gid }}"
    command: tunnel run
    environment:
      - TUNNEL_TOKEN=${CLOUDFLARED_TUNNEL_TOKEN}
    extra_hosts:
      - "host.docker.internal:host-gateway"
    networks:
      - ghostship_net

  muximux:
    image: lscr.io/linuxserver/muximux:latest
    container_name: muximux
    restart: always
    environment:
      - PUID={{ apps_uid }}
      - PGID={{ apps_gid }}
      - TZ=UTC
    volumes:
      - ${CONFIG_DIR}/muximux:/config
    networks:
      - ghostship_net

  gluetun:
    image: qmcgaw/gluetun:latest
    container_name: gluetun
    user: "0:0"
    cap_add:
      - NET_ADMIN
    devices:
      - /dev/net/tun:/dev/net/tun
    environment:
      - VPN_SERVICE_PROVIDER=surfshark
      - VPN_TYPE=wireguard
      - WIREGUARD_PRIVATE_KEY=${WIREGUARD_PRIVATE_KEY}
      - WIREGUARD_ADDRESSES=10.14.0.2/16
      - SERVER_COUNTRIES=${VPN_COUNTRY}
      - TZ=UTC
      - UPDATER_PERIOD=24h
    volumes:
      - ${CONFIG_DIR}/gluetun:/gluetun
    restart: always
    healthcheck:
      test: ["CMD", "/gluetun-entrypoint", "healthcheck"]
      interval: 10s
      timeout: 5s
      retries: 5
    networks:
      - ghostship_net

  nzbget:
    image: lscr.io/linuxserver/nzbget:latest
    container_name: nzbget
    restart: always
    environment:
      - PUID={{ apps_uid }}
      - PGID={{ apps_gid }}
      - TZ=UTC
    volumes:
      - ${CONFIG_DIR}/nzbget:/config
      - type: volume
        source: share
        target: /downloads
        volume:
          subpath: Downloads/Usenet
    network_mode: service:gluetun
    depends_on:
      gluetun:
        condition: service_healthy

  qbittorrent:
    image: lscr.io/linuxserver/qbittorrent:latest
    container_name: qbittorrent
    restart: always
    environment:
      - PUID={{ apps_uid }}
      - PGID={{ apps_gid }}
      - TZ=UTC
      - WEBUI_PORT=5000
      - DOCKER_MODS=ghcr.io/vuetorrent/vuetorrent-lsio-mod:latest
    volumes:
      - ${CONFIG_DIR}/qbittorrent:/config
      - type: volume
        source: share
        target: /downloads
        volume:
          subpath: Downloads/Torrent
    network_mode: service:gluetun
    depends_on:
      gluetun:
        condition: service_healthy

  plex:
    image: lscr.io/linuxserver/plex:latest
    container_name: plex
    restart: always
    networks:
      - ghostship_net
    ports:
      - 32400:32400
      - 1900:1900/udp
      - 3005:3005
      - 5353:5353/udp
      - 8324:8324
      - 32410:32410/udp
      - 32412:32412/udp
      - 32413:32413/udp
      - 32414:32414/udp
      - 32469:32469
    environment:
      - PUID={{ apps_uid }}
      - PGID={{ apps_gid }}
      - TZ=UTC
      - VERSION=latest
      - PLEX_CLAIM=${PLEX_CLAIM}
    devices:
      - /dev/dri:/dev/dri
    volumes:
      - ${CONFIG_DIR}/plex:/config
      - type: volume
        source: share
        target: /library
        volume:
          subpath: Library

  plex-auto-languages:
    image: remirigal/plex-auto-languages:latest
    container_name: plex-auto-languages
    restart: always
    environment:
      - PLEX_URL=http://plex:32400
      - PLEX_TOKEN=${PLEX_TOKEN}
      - TZ=UTC
      - PUID={{ apps_uid }}
      - PGID={{ apps_gid }}
    volumes:
      - ${CONFIG_DIR}/plex-auto-languages:/config
    networks:
      - ghostship_net

  prowlarr:
    image: lscr.io/linuxserver/prowlarr:latest
    container_name: prowlarr
    restart: always
    environment:
      - PUID={{ apps_uid }}
      - PGID={{ apps_gid }}
      - TZ=UTC
    volumes:
      - ${CONFIG_DIR}/prowlarr:/config
    networks:
      - ghostship_net

  sonarr:
    image: lscr.io/linuxserver/sonarr:latest
    container_name: sonarr
    restart: always
    environment:
      - PUID={{ apps_uid }}
      - PGID={{ apps_gid }}
      - TZ=UTC
    volumes:
      - ${CONFIG_DIR}/sonarr:/config
      - type: volume
        source: share
        target: /downloads
        volume:
          subpath: Downloads
      - type: volume
        source: share
        target: /tv
        volume:
          subpath: Library/TV
    networks:
      - ghostship_net

  radarr:
    image: lscr.io/linuxserver/radarr:latest
    container_name: radarr
    restart: always
    environment:
      - PUID={{ apps_uid }}
      - PGID={{ apps_gid }}
      - TZ=UTC
    volumes:
      - ${CONFIG_DIR}/radarr:/config
      - type: volume
        source: share
        target: /downloads
        volume:
          subpath: Downloads
      - type: volume
        source: share
        target: /movies
        volume:
          subpath: Library/Movies
    networks:
      - ghostship_net

  bazarr:
    image: lscr.io/linuxserver/bazarr:latest
    container_name: bazarr
    restart: always
    environment:
      - PUID={{ apps_uid }}
      - PGID={{ apps_gid }}
      - TZ=UTC
    volumes:
      - ${CONFIG_DIR}/bazarr:/config
      - type: volume
        source: share
        target: /movies
        volume:
          subpath: Library/Movies
      - type: volume
        source: share
        target: /tv
        volume:
          subpath: Library/TV
    networks:
      - ghostship_net

  flaresolverr:
    image: ghcr.io/flaresolverr/flaresolverr:latest
    container_name: flaresolverr
    restart: always
    environment:
      - TZ=UTC
      - LOG_LEVEL=info
    networks:
      - ghostship_net

  posterizarr:
    image: ghcr.io/fscorrupt/posterizarr:latest
    container_name: posterizarr
    restart: always
    user: "{{ apps_uid }}:{{ apps_gid }}"
    environment:
      - PUID={{ apps_uid }}
      - PGID={{ apps_gid }}
      - TZ=UTC
      - TERM=xterm
      - RUN_TIME=disabled
    volumes:
      - ${CONFIG_DIR}/posterizarr:/config
      - ${CONFIG_DIR}/posterizarr/assets:/assets
      - ${CONFIG_DIR}/posterizarr/assetsbackup:/assetsbackup
      - ${CONFIG_DIR}/posterizarr/manualassets:/manualassets
    networks:
      - ghostship_net

  tautulli:
    image: lscr.io/linuxserver/tautulli:latest
    container_name: tautulli
    restart: always
    environment:
      - PUID={{ apps_uid }}
      - PGID={{ apps_gid }}
      - TZ=UTC
    volumes:
      - ${CONFIG_DIR}/tautulli:/config
      - ${CONFIG_DIR}/plex/Library/Application Support/Plex Media Server/Logs:/logs:ro
    networks:
      - ghostship_net

  metube:
    image: ghcr.io/alexta69/metube:latest
    container_name: metube
    restart: always
    environment:
      - UID={{ apps_uid }}
      - GID={{ apps_gid }}
    volumes:
      - type: volume
        source: share
        target: /downloads
        volume:
          subpath: Downloads/MeTube
    networks:
      - ghostship_net

  pyload:
    image: lscr.io/linuxserver/pyload-ng:latest
    container_name: pyload
    restart: always
    environment:
      - PUID={{ apps_uid }}
      - PGID={{ apps_gid }}
      - TZ=UTC
    volumes:
      - ${CONFIG_DIR}/pyload:/config
      - type: volume
        source: share
        target: /downloads
        volume:
          subpath: Downloads/PyLoad
    networks:
      - ghostship_net

  bentopdf:
    image: bentopdf/bentopdf:latest
    container_name: bentopdf
    restart: always
    networks:
      - ghostship_net

  it-tools:
    image: corentinth/it-tools:latest
    container_name: it-tools
    restart: always
    networks:
      - ghostship_net

  romm:
    image: rommapp/romm:latest
    container_name: romm
    restart: always
    user: "{{ apps_uid }}:{{ apps_gid }}"
    environment:
      - DB_HOST=mariadb
      - DB_NAME=romm
      - DB_USER=romm
      - DB_PASSWD=${ROMM_DB_PASSWORD}
      - ROMM_AUTH_SECRET_KEY=${ROMM_AUTH_SECRET}
      - IGDB_CLIENT_ID=${ROMM_IGDB_CLIENT_ID}
      - IGDB_CLIENT_SECRET=${ROMM_IGDB_CLIENT_SECRET}
      - RETROACHIEVEMENTS_API_KEY=${ROMM_RETROACHIEVEMENTS_API_KEY}
      - STEAMGRIDDB_API_KEY=${ROMM_STEAMGRIDDB_API_KEY}
      - HASHEOUS_API_ENABLED=true
      - HLTB_API_ENABLED=true
      - PUID={{ apps_uid }}
      - PGID={{ apps_gid }}
    volumes:
      - ${CONFIG_DIR}/romm/resources:/romm/resources
      - ${CONFIG_DIR}/romm/redis-data:/redis-data
      - ${CONFIG_DIR}/romm/config:/romm/config
      - type: volume
        source: share
        target: /romm/library
        volume:
          subpath: Library/ROMs
      - type: volume
        source: share
        target: /romm/assets
        volume:
          subpath: Library/ROMs/.romm
    depends_on:
      mariadb:
        condition: service_healthy
    networks:
      - ghostship_net

  mariadb:
    image: lscr.io/linuxserver/mariadb:latest
    container_name: mariadb
    restart: always
    environment:
      - PUID={{ apps_uid }}
      - PGID={{ apps_gid }}
      - TZ=UTC
    volumes:
      - ${CONFIG_DIR}/mariadb:/config
    healthcheck:
      test: ["CMD", "mariadb-admin", "ping", "-h", "localhost"]
      interval: 10s
      timeout: 5s
      retries: 5
    networks:
      - ghostship_net

  tdarr:
    image: ghcr.io/haveagitgat/tdarr:latest
    container_name: tdarr
    restart: always
    environment:
      - TZ=UTC
      - PUID={{ apps_uid }}
      - PGID={{ apps_gid }}
      - UMASK_SET=002
      - serverIP=0.0.0.0
      - serverPort=8266
      - webUIPort=8265
      - internalNode=true
      - inContainer=true
      - nodeName=tdarr-node
    devices:
      - /dev/dri:/dev/dri
    volumes:
      - ${CONFIG_DIR}/tdarr/server:/app/server
      - ${CONFIG_DIR}/tdarr/configs:/app/configs
      - ${CONFIG_DIR}/tdarr/logs:/app/logs
      - ${CONFIG_DIR}/tdarr/transcode:/temp
      - type: volume
        source: share
        target: /media
        volume:
          subpath: Library
    networks:
      - ghostship_net

  homeassistant:
    image: lscr.io/linuxserver/homeassistant:latest
    container_name: homeassistant
    restart: always
    environment:
      - PUID={{ apps_uid }}
      - PGID={{ apps_gid }}
      - TZ=UTC
    volumes:
      - ${CONFIG_DIR}/homeassistant:/config
    networks:
      - ghostship_net

  changedetection:
    image: lscr.io/linuxserver/changedetection.io:latest
    container_name: changedetection
    restart: always
    environment:
      - PUID={{ apps_uid }}
      - PGID={{ apps_gid }}
      - TZ=UTC
    volumes:
      - ${CONFIG_DIR}/changedetection:/config
    networks:
      - ghostship_net

  arcane:
    image: ghcr.io/getarcaneapp/arcane:latest
    container_name: arcane
    restart: always
    environment:
      - PUID={{ apps_uid }}
      - PGID={{ apps_gid }}
      - TZ=UTC
      - APP_URL=http://arcane:3552
      - ENCRYPTION_KEY=${ARCANE_ENCRYPTION_KEY}
      - JWT_SECRET=${ARCANE_JWT_SECRET}
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock:ro
      - ${CONFIG_DIR}/arcane:/app/data
      - ${INSTALL_DIR}:/app/data/projects
    networks:
      - ghostship_net

  booklore:
    image: booklore/booklore:latest
    container_name: booklore
    restart: always
    environment:
      - USER_ID={{ apps_uid }}
      - GROUP_ID={{ apps_gid }}
      - TZ=UTC
      - DATABASE_URL=jdbc:mariadb://mariadb:3306/booklore
      - DATABASE_USERNAME=booklore
      - DATABASE_PASSWORD=${BOOKLORE_DB_PASSWORD}
      - BOOKLORE_PORT=6060
    depends_on:
      mariadb:
        condition: service_healthy
    volumes:
      - ${CONFIG_DIR}/booklore:/app/data
      - type: volume
        source: share
        target: /books
        volume:
          subpath: Library/Books
      - type: volume
        source: share
        target: /bookdrop
        volume:
          subpath: Library/Books/.bookdrop
    networks:
      - ghostship_net

  manyfold:
    image: ghcr.io/manyfold3d/manyfold-solo:latest
    container_name: manyfold
    restart: always
    environment:
      - SECRET_KEY_BASE=${MANYFOLD_SECRET_KEY}
      - PUID={{ apps_uid }}
      - PGID={{ apps_gid }}
      - TZ=UTC
    volumes:
      - ${CONFIG_DIR}/manyfold:/config
      - type: volume
        source: share
        target: /models
        volume:
          subpath: Library/3D
    networks:
      - ghostship_net

  convertx:
    image: ghcr.io/c4illin/convertx:latest
    container_name: convertx
    restart: always
    user: "{{ apps_uid }}:{{ apps_gid }}"
    environment:
      - HTTP_ALLOWED=true
      - ACCOUNT_REGISTRATION=false
      - ALLOW_UNAUTHENTICATED=true
      - HIDE_HISTORY=true
    volumes:
      - ${CONFIG_DIR}/convertx:/app/data
    networks:
      - ghostship_net

  homepage:
    image: ghcr.io/gethomepage/homepage:latest
    container_name: homepage
    restart: always
    user: "{{ apps_uid }}:{{ docker_gid }}"
    environment:
      - PUID={{ apps_uid }}
      - PGID={{ docker_gid }}
      - TZ=UTC
      - HOMEPAGE_ALLOWED_HOSTS=*
    volumes:
      - ${CONFIG_DIR}/homepage:/app/config
      - /var/run/docker.sock:/var/run/docker.sock
    networks:
      - ghostship_net

networks:
  ghostship_net:
    driver: bridge

volumes:
  share:
    driver: local
    driver_opts:
      type: nfs
      o: "addr=192.168.200.106,rw,nfsvers=4,hard,intr,rsize=8192,wsize=8192"
      device: ":/volume1/share"
